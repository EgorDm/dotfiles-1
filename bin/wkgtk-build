#! /bin/bash
#
# wkgtk-build
# Copyright (C) 2014 Adrian Perez <aperez@igalia.com>
#
# Distributed under terms of the MIT license.
#

# Common build options
declare -a build_options=(
	--gtk
)

# Detect whether we are building inside jhbuild, to adjust paths accordingly
if [[ -n ${JHBUILD_PREFIX} ]] ; then
	build_options=( "${build_options[@]}" "--prefix=${JHBUILD_PREFIX}" )
	if [[ -n ${JHBUILD_LIBDIR} ]] ; then
		build_options=( "${build_options[@]}" "--libdir=${JHBUILD_LIBDIR}" )
	fi
fi

: ${CC:='clang -Qunused-arguments'}
: ${CXX:='clang++ -Qunused-arguments'}

if [[ ${CXX} = *clang++\ * && -z ${NO_LIBCXX} ]] ; then
	CXXFLAGS='-stdlib=libc++'
	LDFLAGS='-stdlib=libc++ -lc++abi'
fi

cat <<EOF
CC      : ${CC}
CXX     : ${CXX}
CXXFLAGS: ${CXXFLAGS}
LDFLAGS : ${LDFLAGS}
EOF

export PKG_CONFIG_PATH CC CXX CXXFLAGS LDFLAGS
set -x
exec build-webkit "${build_options[@]}" "$@"
